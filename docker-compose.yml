version: '3.9'
services:
    bastion:
        image: wato-bastion
        build: .
        ports:
            - '22:22'
        environment:
            - MFA_PROVIDER=none
        volumes:
            # Files required by the guest are
            # - /etc/passwd
            # - /etc/shadow,
            # - /etc/group.
            # Mounting the entire /etc instead of the individual files so that
            # changes to the files can reflect in the container:
            # https://stackoverflow.com/a/53548078
            # https://github.com/moby/moby/issues/15793#issuecomment-512913198
            - '/etc:/etc.host:ro'
            - '/home:/home'
            - './secrets/ssh_host_rsa_key:/etc/ssh/ssh_host_rsa_key:ro'
            - './secrets/ssh_host_rsa_key.pub:/etc/ssh/ssh_host_rsa_key.pub:ro'
        hostname: wato-bastion-secure
        dns:
            # wato cluster DNS
            - 10.0.50.254
            # UWaterloo DNS
            - 129.97.2.1
            - 129.97.2.2
        restart: always

